\documentclass{article}
% Commands
\newcommand{\ASSNMT}{Project Necromancer}
\newcommand{\CLASS}{Design Document}
\newcommand{\Footer}{Grand Valley State University}

\newcommand{\DATE}{April 2015}

% Packages
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{lmodern}
% \usepackage{pdflscape}
\usepackage{geometry}
\usepackage[usenames,dvipsnames]{xcolor}
\usepackage{graphicx}
\usepackage{mathtools}
\usepackage[justification=centering]{caption}
\usepackage{amssymb}
\usepackage[pdftex, pdfborderstyle={/S/U/W 0}]{hyperref} % this disables the boxes around links]
\usepackage{float}
\usepackage{listings}
% \usepackage{color}
\usepackage{enumitem}
\usepackage{fancyhdr}
\usepackage{caption}
\numberwithin{figure}{section}
\usepackage{amsmath}

\numberwithin{equation}{section}
% lstlisting
\definecolor{dkgreen}{rgb}{0,0.6,0}
\definecolor{gray}{rgb}{0.5,0.5,0.5}
\definecolor{mauve}{rgb}{0.58,0,0.82}
\lstset
{
  frame=single,
  frameround=tttt,
  language=C,
  numberstyle=\tiny\color{gray},
  keywordstyle=\color{blue},
  commentstyle=\color{dkgreen},
  stringstyle=\color{mauve},
  tabsize=3,
  breaklines=true,
  basicstyle={\small\ttfamily},
  xleftmargin=\fboxsep,
  xrightmargin=-\fboxsep,
  numbers = left,
  stepnumber = 5,
  firstnumber = 1
}

% macro for appendix to be printed as "Appendix A {name of appendix}"
% instead of "A {name of appendix}"
% From: http://tex.stackexchange.com/questions/160839/having-appendix-a-instead-of-a-appendix
\makeatletter
%% The "\@seccntformat" command is an auxiliary command
%% (see pp. 26f. of 'The LaTeX Companion,' 2nd. ed.)
\def\@seccntformat#1{\@ifundefined{#1@cntformat}%
   {\csname the#1\endcsname\quad}  % default
   {\csname #1@cntformat\endcsname}% enable individual control
}
\let\oldappendix\appendix %% save current definition of \appendix
\renewcommand\appendix{%
    \oldappendix
    \newcommand{\section@cntformat}{\appendixname~\thesection\quad}
}
\makeatother


\begin{document}
% =====----- Initial Set Up -----=====
% Title Page
\newgeometry{top=2cm,left=1cm,bottom=1cm,right=1cm}
\begin{flushleft}
\pagenumbering{gobble}

\textsc{\LARGE \bfseries \ASSNMT}\\

\textsc{\Large \CLASS}\\[0.2cm]
\linethickness{0.5mm}
{\color{ForestGreen}\line(1,0){350}} \\ [1.0cm]

\begin{flushleft} \large
\begin{tabular}{lll}
  Sponsored By: & The Rainforest Connection (RFCx) \includegraphics[height=0.4cm]{rfcxlogo} & \\
                &               & \\
  Submitted By: & Joe Gibson    & \href{mailto:gibsjose@mail.gvsu.edu}{gibsjose@mail.gvsu.edu}\\
              & David Adlof     & \href{mailto:adlofd@mail.gvsu.edu}{adlofd@mail.gvsu.edu}\\
              & Kalee Stutzman  & \href{mailto:stutzmak@mail.gvsu.edu}{stutzmak@mail.gvsu.edu}\\
              & Jesse Millwood  & \href{mailto:millwooj@mail.gvsu.edu}{millwooj@mail.gvsu.edu}\\
\end{tabular}

\bigskip

\bigskip
Date Submitted: \DATE
\end{flushleft}

\smallskip
{\color{ForestGreen}\line(1,0){350}} \\ [1.0cm]
\section*{Executive Summary} \label{sect:execsum}
Software, electrical, and hardware enhancements to Rainforest Connection’s currently used device are proposed in this paper. The electrical enhancements include the addition of a new PCB that contains power regulation and battery charging circuitry, along with current, voltage, temperature, and humidity sensors. The software enhancements include sending sensor measurements to an Android cellphone. Sending measurements from the PCB to the phone will allow for diagnostic feedback that can be used for laboratory testing and verification as well as field statistics. The point of this project is not to entirely redesign the existing device but rather to provide modular enhancements and improvements to specific components.

\bigskip
Power consumption is a major concern and a key area for improvement on the existing device. We will use \textit{Max Point Power Tracking}(MPPT) ICs in the design of the power regulation and solar panel interface to ensure maximum efficiency from the solar panels. In addition we will use Lithium-Ion battery management ICs to ensure that the batteries are properly charge, properly discharge, and to prevent overheating. A switching power regulator will boost the voltage from either the batteries or the solar panel to charge the phone and a linear dropout regulator will provide 3.3V to the regulation and diagnostic circuitry on the PCB.

\bigskip
Temperature is another major concern. To mitigate the heat produced by the phone, the power circuitry, and the environment, a heatsink will be attached to the PCB with direct thermal contact with the phone. The heatsink will extend outside of the enclosure, transferring heat outside of the device enclosure.

\bigskip
Sending diagnostics will be achieved using an 8-bit Atmel ATmega328P microcontroller. Power, temperature, and humidity data will be sent from the microcontroller to the cell phone via USB, where it will be received and displayed by an Android application.

\section*{Keywords} \label{sect:keywords}
Rain forest, Recycling, RFCx, Rainforest Connection, cellphone, Android, logging

\vfill

% Bottom of the page
\begin{center}
{\large \Footer}
\end{center}
\begin{figure}[H]
  \centering
  \includegraphics[width=.1\textwidth]{small_gvsu}
\end{figure}
\end{flushleft}
\restoregeometry
\newpage
% Define Page Geometry for rest of report
{\newgeometry{left=0.8in, right=0.8in, top=1in, bottom=1in}
% Page Numbers
\pagenumbering{arabic}
\pagestyle{fancy}
\fancyhf{}
\lhead{\ASSNMT}
\rhead{\leftmark}
\rfoot{Page \thepage}
% No paragraph indents
\setlength{\parindent}{0cm}
% =====----- Rest of Report -----=====
\newpage
\tableofcontents
\newpage
\section{RFCx Background} \label{sect:background}
Rainforest Connection (RFCx) is a non-profit organization that is dedicated to stopping illegal logging and deforestation in rainforests throughout the world. The destruction of tropical rainforests is a leading cause of carbon dioxide emission, and much of it is caused by illegal activities. RFCx combats illegal logging with devices using re-purposed cell-phones strategically placed in trees in remote areas. A picture of the entire device is shown below in Figure \ref{fig:device}.

\begin{figure}[H]
  \centering
  \includegraphics[width=0.8\textwidth]{device}
  \caption{RFCx President Topher White installing an existing device in the rainforests of Borneo}
  \label{fig:device}
\end{figure}
\newpage

These devices listen and record audio streams at all times, using their data connection to periodically send audio data to the RFCx server. On the server, digital signal processing algorithms are used to detect the sound of chainsaws and engines at a distance of up to $\frac{2}{3}$ of a mile. If a chainsaw is detected, a real-time alert is sent to pre-existing ground patrols, who can react to the situation and combat the threat. In addition to man-made sounds, the RFCx platform is also used to record the sounds of animals in the forest. These sounds can be used to gain information about certain species of animals and are open to anyone to use and analyze. Because of the sheer size of the area covered by a single human, it is impractical, if not impossible, to properly monitor the forests for illegal activities without the aid of technology. The flow of data, from audio collection to human intervention, is shown below in Figure \ref{fig:infographic}.

\begin{figure}[H]
  \centering
  \includegraphics[height=0.76\textwidth]{infographic}
  \caption{Infographic from RFCx website (www.rfcx.org) showing the flow of data}
  \label{fig:infographic}
\end{figure}
\newpage

\section{Project Introduction} \label{sect:intro}
RFCx Project Necromancer is primarily comprised of enhancements to the existing system in the areas of power consumption, power efficiency, temperature concerns, and overall modularity of components. The devices currently consist of an Android phone, Radioshack enclosure, off-the-shelf external microhpone and antenna, RFCx solar petals, two dual-cell Lithium-Ion batteries, and  various off-the-shelf PCBs and individual electrical components comprising the power regulation and solar and battery management control. The external microphone, antenna, solar petals, batteries (Appendix \ref{fig:batdat}), and Android phone will remain the same. A view inside of the device is shown in Figure \ref{fig:device_inside}.

\begin{figure}[H]
  \centering
  \includegraphics[width=0.8\textwidth]{device_inside}
  \caption{Inside of a device: Android phone, batteries, and various electrical components. Some solar charge controller PCBs can be seen in red at the bottom of the enclosure}
  \label{fig:device_inside}
\end{figure}
\newpage

The solar panel array consists of four petals, each of which has two solar panels on it. The panels are designed and patented by RFCx to work well under low light conditions such as those under the tree canopy. A single petal produces 1.5W of power under laboratory conditions. An individual petal can be seen in Figure \ref{fig:solar_petal}

\begin{figure}[H]
  \centering
  \includegraphics[width=0.8\textwidth]{solar_petal}
  \caption{A single solar petal consisting of two panels. Each panel is made from three strips of panel scraps left over from manufacturing at major solar panel companies, connected in series to produce a 1.5V output on each panel}
  \label{fig:solar_petal}
\end{figure}
\newpage

In regards to device enhancements, the principal objective of Project Necromancer is to merge all of the external electronics into a custom printed circuit board. This involves integrating the regulation circuitry and photovoltaic battery charge controller into a single board, and also introducing sensors for temperature, humidity, and power, a microcontroller, and other supporting electronics. The power, temperature, and humidity diagnostics will be sent from the microcontroller to the Android phone via a USB connection. Relaying the collected diagnostic data to the server is possible with the existing framework but is outside of the scope of this project. Instead, the collected data will be displayed for testing and verification purposes. A block diagram of the designed system is shown below in Figure \ref{fig:hldia}.

\begin{figure}[H]
  \centering
  \includegraphics[width=0.8\textwidth]{Highlevel}
  \caption{High Level Functional Diagram of the Major Components}
  \label{fig:hldia}
\end{figure}
\newpage

On the phone, an app called RFCx Sentinel monitors the incoming diagnostics, displaying them to a screen, logging them to a file, and perhaps in the future transmitting them along with the audio data to the server. The RFCx Sentinel Application was developed by our team for the purpose of this project. An actual screenshot of the Sentinel application receiving data from a microcontroller is shown below in Figure \ref{fig:sentscrn}. In addition, although outside of the scope of this project, different audio compression schemes may be investigated if time allows.

\begin{figure}[H]
	\centering
	\includegraphics[width=0.4\textwidth]{RFCxSentinelScreenshot}
	\caption{Actual RFCx Sentinel App Screenshot}
	\label{fig:sentscrn}
\end{figure}
\newpage

%@TODO Introduce and display this figure (although we really should use a different angle here...)
% \begin{figure}[H]
%   \centering
%   \includegraphics[width=0.8\textwidth]{DeviceDesign}
%   \caption{3D Rendering of Final Device Design: Shows the relative placement of the phone and PCB inside of the enclosure}
%   \label{fig:devdesign}
% \end{figure}

\section{Requirements and Functional Specifications} \label{sect:requirementsandspec}
This section is organized by external and internal interfaces, with subsections in each for both hardware and software requirements.

\subsection{External Interfaces Requirements} \label{sect:externinterface}
This section addresses the requirements of the enhanced device pertaining to its external interfaces. External interfaces are defined as components of the device interacting with something outside of the device enclosure, including the antenna, microphone, solar panels, and GSM data communication. The possibility of compression is included under external interfaces because it directly relates to the sending of data outside of the device to the server.

\subsubsection{Hardware} \label{sect:hardware1}
\begin{enumerate}[align=left,leftmargin=*, labelindent= 0em, label=\textbf{Requirement \thesubsubsection.\arabic*.}, itemindent=0em]

\item \label{HWa} The device shall not exceed the existing power consumption and should reduce power consumption by at least 10\%.
\item \label{HWb} The interface with the phone shall consist of a USB connection for power and data, a 3.5mm microphone connection via the standard audio jack, and a connection to the external antenna via the existing antenna cable.
\item \label{HWc}The device shall use the existing external microphone and antennae
\item \label{HWd} Shielding techniques should be investigated to reduce the GSM audio interference noted by Topher White in the audio recordings.
\item \label{HWf} Camouflage color scheme may be used to conceal the device from loggers.  Additional camouflage features may be added so long as those features do not cover the solar panels.
\item \label{HWg} A simple assembly process shall be well documented with illustrations.

\baselinestretch
To verify \ref{HWg}. a sample group of people with varying skill levels will be asked to provide feedback on the assembly process and will be timed. The assembly times will be compared with current assembly times.

\item \label{HWh} The assembly and installation documentation may be translated into Spanish, French, and/or Portuguese.
\end{enumerate}
\subsubsection{Software} \label{sect:software1}
\begin{enumerate}[align=left,leftmargin=*, labelindent= 0em, label=\textbf{Requirement \thesubsubsection.\arabic*.}, itemindent=0em]
\item \label{SWa} The algorithm used to compress the audio signal may be compared to other existing algorithms and may be changed as such depending on the outcomes of comparative testing.

\baselinestretch
To verify \ref{SWa}, audio will be recorded and compressed using multiple algorithms including the current algorithm. An infographic hosted on RFCx’s website, shown in Figure 2 illustrates the flow of data that is collected from the phone and analyzed on the server.
\end{enumerate}

\subsection{Internal Device Requirements} \label{sect:internaldev}
This section addresses the requirements of the enhanced device pertaining to its internal interfaces and software. Internal here is defined as anything inside of the device enclosure, including but not limited to the Android phone, batteries, custom PCB, and supporting electronics.

\subsubsection{Hardware} \label{sect:hardware2}
\begin{enumerate}[align=left,leftmargin=*, labelindent= 0em, label=\textbf{Requirement \thesubsubsection.\arabic*.}, itemindent=0em]
\item \label{HW1}The PCB shall consist of battery management circuitry, the power regulation circuitry, power interface to the phone, power monitoring circuitry, as well as the microphone interface.

\baselinestretch
To verify \ref{HW1}, SPICE will be used to simulate the power charging circuitry to obtain power consumption and efficiency calculations. The manufactured and assembled board will then be subjected to a load test in a lab setting.

\item \label{HW3}There should be a low power microcontroller included on the PCB that communicates with the Android phone, sending it diagnostic information about components on the PCB. This will be used to monitor power consumption and provide external control of peripherals through the Android Debug Bridge protocol over USB. Extra general purpose pins of the microcontroller should be easily accessible for interfacing with future hardware.

\baselinestretch
To verify \ref{HW3}, simple packets will be sent from the microcontroller to the phone. These packets can be verified with debug tools or simple programs on the microcontroller and the phone. A debug serial port may be included as a peripheral to the microcontroller to aid in debugging. Any analog values read by the microcontroller will be verified with shop equipment.

\item \label{HW4} The monetary cost of the device, not including the solar panels, shall not exceed 25\% more than the current device cost, also not including the solar panels. The current cost of the solar panels has been quoted at \$200 and the rest of the device has been quoted at \$200. Increases in monetary cost above the current cost and below 125\% of the current cost are for enhancements in functionality (i.e. the PCB, etc.) and reductions in assembly time.

\end{enumerate}
\subsubsection{Software} \label{sect:software2}
\begin{enumerate}[align=left,leftmargin=*, labelindent= 0em, label=\textbf{Requirement \thesubsubsection.\arabic*.}, itemindent=0em]
\item \label{SW1}The microcontroller software should be capable of bi-directional communication between itself and the Android phone.
\item \label{SW2}The microcontroller software should be capable of communicating power usage diagnostics to the phone over the ADB protocol.
\item \label{SW3}An Android companion application may be capable of reporting power diagnostics from the microcontroller for testing and debugging.
\item \label{SW4}There shall be a header on the PCB to program to reprogram the microcontroller.
\end{enumerate}

\section{Component Justification} \label{sect:justification}
This section describes each component of the PCB in detail and gives justifications for their selection and a discussion of alternative choices that were considered. Two main concerns for every component is packaging and power consumption. There should be no component that the end user can not fix to the PCB without common soldering equipment. Power consumption is a major concern as the device is meant to be located in a remote area and powered by batteries and solar power. 

%@TODO Add references to the datasheets for the list as well as all references inside the justifications

\bigskip
The following is a list of the main ICs that comprise the PCB and are outlined in this section:
\begin{description}[font=$\bullet$\scshape\bfseries]
\item[Atmel ATMega328P]: 8-bit AVR microcontroller (Appendix \ref{fig:atmeldat})
\item[SPV1040 Max Point Power Tracker]: Solar power controller and lithium-ion battery charger (Appendix \ref{fig:spvdat})
\item[ADS1015]: External 4-input 12-bit Analog-to-Digital Converter, I2C communication (Appendix \ref{fig:adsdat})
\item[LM75BD]: Ultra Low Power Temperature Sensor,$\pm 2^{\circ}C$, I2C communication (Appendix \ref{fig:lm75dat})
\item[(Optional) HIH6130]: 14-bit resolution Humidity and Temperature Sensor with accuracy of $\pm4$\% Relative Humidity and $\pm 1^{\circ}C$, I2C communication (Appendix \ref{fig:hihdat})
\item[FT230X]: FTDI USB-UART interface for USB serial communication (Appendix \ref{fig:ftdidat})
\item[BQ2057CTS]: Linear Battery Charge Management IC (Appendix \ref{fig:bq2057dat})
\item[LM61428]: Simple Switcher Boost Controller IC (Appendix \ref{fig:lmrdat})
\item[SM72238]: Micropower Fixed 3.3V LDO (Appendix \ref{fig:sm72dat})
\item[LTC6800]: Rail-To-Rail Input and Output Instrumentation Amplifier (Appendix \ref{fig:ltc6800dat})
\item[LTC4412]: Low loss powerpath controller (Appendix \ref{fig:ltc4412dat})
\end{description}

\subsection{Microcontroller} \label{sect:micro_just}
The ATmega328P microcontroller (Appendix \ref{fig:atmeldat}) was chosen as the microcontroller for the PCB. Many aspects were considered when choosing a microcontroller, including power consumption, available interfaces, availability of code samples, community support, ease of programming, and package size.

\bigskip
To this end, the ATmega328P is a logical choice; it is the microcontroller used by the popular Arduino platform, which means there are a multitude of code samples to reference for most any project. In addition, the 328P has a pico-power deep sleep mode, which consumes under 0.1$\mu$A of current. Unlike many options, the 328P has an easy to solder TQFP package. It is also is easily programmed by the use of an ICSP interface and does not require expensive hardware programmers or debuggers.

\bigskip
USB communication was another concern when choosing a microcontroller. Similar MCUs that included on-board USB interfaces were also considered, but none could be found that offered the simple package, deep sleep mode, and I2C communication. I2C communication is needed to communicate with the analog-to-digital converter and temperature/humidity sensors.

\subsection{MPPT} \label{sect:mppt_just}
The SPV1040 Max Point Power Tracker (MPPT) (Appendix \ref{fig:spvdat}) was chosen to perform the solar charge management. A driving factor in choosing the SPV1040 was that RFCx had already established a supplier and had many on-hand to ship us for prototyping. In addition, it has the advantage of being simpler to use than similar chips, like the Solar Magic SM72442, in that no I2C communication is necessary to set and configure registers to perform the same function. Finally, the currently used MCP73871 chip (currently on an off-the-shelf Adafruit board) fails in both the physical package being difficult to assemble by hand (QFN package) when used alone, and being meant for only single-cell Lithium-Ion batteries. In addition, the MCP73871 does not use a true MPPT algorithm, but rather an approximation.

\subsection{MPPT Configuration} \label{sect:mppt_config_just}
The MPPT configuration makes a large difference in many aspects of the selection of other components. First, each MPPT can only handle 1.8A of current. Also, the input voltage of each MPPT must be much less than the desired output voltage for them to function properly. Depending on the configuration, the number of MPPT ICs can vary from 1 to 8, increasing cost, and the voltage and current characterstics vary depending on whether they are connected in series or in parallel.

\bigskip
The following figure (Figure \ref{fig:mppt_config2}) describes the chosen MPPT configuration. In this configuration, each petal, which consists of two 1.5V panels, has its panels connected in series, giving an output of 3.0V, at 1.5W. This results in a current of 500mA for each MPPT, which is well below the maximum. Each petal (four total) is then connected to its own MPPT, which is set to boost to 5.2V. The MPPTs are then connected in parallel.

\begin{figure}[H]
  \centering
  \includegraphics[width=0.8\textwidth]{MPPTConfig2}
  \caption{Four MPPTs are connected in parallel with the input being the series connection of each panel within a single petal}
  \label{fig:mppt_config2}
\end{figure}

This configuration offers many benefits. First, the panels on a single petal can be either connected in series or in parallel. Since the SPV1040 can handle up to 1.8A, even when connected in parallel the petal will only produce a maximum of 1A. The input voltage to the MPPT can be either 1.5V (panels in parallel) or 3.0V (series), and the MPPT's internal boost regulator will still produce 5.2V. This allows for testing configurations where all petals have their panels connected in parallel, all in seriese, or a combination of both under different lighting conditions to see which performs the best without modifying the PCB in any way.

\bigskip
In addition, this configuration localizes the power tracking to an individual petal. Rather than maximizing the entire array, localizing to each petal allows for some petals to be in direct sunlight while others are in shade and each MPPT will react accoringly.

\bigskip
Furthermore, this configuration could be easily adapted to using less MPPTs if needed (to reduce cost, for example). To use two MPPTs, for example, instead of four, two of the ICs would simply not be populated and pairs of petals would be connected in parallel externally and connected to the two populated MPPTs. This is shown in Figure \ref{fig:mppt_config_3}.

\bigskip
Finally, as required by the SPV1040, the input voltage will always be much less than the output in this configuration. The input voltage will be either 1.5V (parallel panels) or 3.0V (series), well below the 5.2V output.

\bigskip
Two other configurations that were considered are shown below. In the first alterate configuration, in Figure \ref{fig:mppt_config1}, two pairs of MPPTs connected in series are then connected in parallel. This has many drawbacks, including requiring a higher output voltage when it is not needed, and requiring the use of diodes to prevent current from backfeeding into the other MPPTs.

\begin{figure}[H]
  \centering
  \includegraphics[width=0.8\textwidth]{MPPTConfig1}
  \caption{Two pairs of MPPTs are first connected in series, then in parallel, requiring the use of feedback diode protection and resulting in a higher than needed output voltage which must then be bucked down}
  \label{fig:mppt_config1}
\end{figure}

The second alternate configuration, in Figure \ref{fig:mppt_config3}, is really the same as the chosen one, but using two MPPTs instead of four as described above.

\begin{figure}[H]
  \centering
  \includegraphics[width=0.8\textwidth]{MPPTConfig3}
  \caption{Chosen configuration but with two MPPTs instead of four. Results in less control but saves the cost of two ICs and the supporting circuitry of each}
  \label{fig:mppt_config3}
\end{figure}

\subsection{ADC} \label{sect:adc_just}
The ADS1015 external ADC (Appendix \ref{fig:adsdat}) was chosen to perform analog-to-digital conversions for the power sensing. The ATmega328P does not have a strong internal ADC, being only 10-bit resolution, and the ADS1015 is easy to communicate with via I2C. In addition, I2C supports multiple devices in parallel, so only two of the ATmega328P's six analog pins are used. This frees the other four for future use. The ADS1015 consumes less than 150$\mu$A, has 12-bit resolution, and supports four single-ended analog inputs, which will be used to monitor input current, input voltage, output current, and output voltage on the PCB.

\subsection{Temperature and Humidity Sensor} \label{sect:temp_just}
The LM75BD (Appendix \ref{fig:lm75dat}) was chosen as the temperature sensor.  The LM75 is a super low power temperature sensor with an accuracy of $\pm2^{\circ}C$. It uses less than 300uA during peak transmission, and costs under \$1.

\bigskip
An alternative sensor prodiving both temperature and humidity measurements, the HIH6130 (Appendix \ref{fig:hihdat}), was also considered. Also using I2C and also being low-power, the only real drawback is the price, at nearly \$14. For this reason the LM75BD was chosen, but the footprint for the HIH6130 will be included but unpopulated on the board as an option to the end user.

Other lower-cost humidity and temperature sensors were investigated, such as the DHT11 and DHT22. The DHT11 is affordable, at around \$5, but has a limited range of 0-50$^{\circ}C$. The DHT22 has the range required and is accurate, but costs almost as much as as the HIH6130 at around \$9. Both the DHT11 and DHT22 are not I2C, but rather use the one-wire-interface which requires elaborate timing to get the correct data, and take up another pin on the microcontroller. In addition, Adafruit and Amazon were the only places that stock the DHT22, neither of which offer the reliability or quantity of sources like Digikey or Mouser.

\subsection{FTDI} \label{sect:ftdi_just}
The FT230X FTDI chip (Appendix \ref{fig:ftdidat}) was chosen for the UART to USB interface between the microcontroller and the Android phone. FTDI is widely used and supported, and, unlike similar devices like the Arduino's CDCACM, does not require another microcontroller to be added, configured, and flashed with software. In addition, the RFCx Sentinel application, which uses the open source usb-serial-for-android library, readily supports FTDI. Serial USB communication has already been achieve using an ATmega328P MCU, a similar FTDI chip, and the Sentinel app.

\subsection{Battery Management} \label{sect:battery_just}
Battery management is important for the ability to reclaim and potentially fix a damaged battery, and also to prevent potential fire hazards. Being in a hot climate and surrounded by ample fuel for a large-scale forest fire, battery management was chosen to be included in the design. The BQ2057CTS battery charge management IC was thus chosen to control the charging of the Lithium-Ion batteries. It is designed for both single and dual-cell battery packs, and combines current and voltage regulation, charge status indication, and charge rate auto compensation.

\subsection{Power Path Management} \label{sect_pow_just}
To manage the power selection between the solar panels and the batteries, a power path management solution was required. This was required because while the batteries are being charged the rest of the circuit should not draw from them. If the rest of the circuit draws from them while they are being charged, the battery charge management IC could get confused and damage the batteries by over charging or under charging. A diode-ORed configuration, in which power sources are ORed together via a near ideal diode($0.02V_f$), selects the source with the higher voltage. The LTC4412 (Appendix \ref{fig:ltc4412dat}) was chosen to perform this power path management. The ideal diodes are implemented externally with a FZT788B P-Channel MOSFET (Appendix \ref{fig:ftzdat}). This IC also has a very low quiescent current, below $1.15\mu A$.

\subsection{Power Regulation} \label{sect:reg_just}
The LMR61428(Appendix \ref{fig:lmrdat}) Step-Up Voltage regulator was chosen because of its price, package, and performance. It is important for all of the ICs on this board to be in a package that the end user can assemble with without the aid of more advanced PCB assembly equipment such as solder paste/stencils and ovens. This means that they can not be in packages where there are pins underneath or too small to place with tweazers. The operation requirements for the LMR61428 where with in the worst case behavior for the feeding circuitry. Some of the other buck/boost controllers required a much higher input voltage when the load current was around 500mA. The LMR61428 requires less than 2V, which is possible even when drawing from the batteries. Since this is design is for a remote device powered from batteries and solar power, quiecent current is a concern as well. The LM61428 only draws 80mA when in the operating mode. 

\subsection{Current Sensing} \label{sect:cur_just}
The LTC6800 precision instrumentation amplifier (Appendix \ref{fig:ltc6800dat}) was chosen to perform current sensing. This instrumentation amplifier operates rail-to-rail on the input and output, which provides a larger window to sense the voltage across the sense resistor. A sense resistor value of 0.010$\Omega$ was chosen to provide minimal power dissipation. Although very small, since the leakage current into the opamp is also extremely small (on the order of 1nA), the trace resistance, which is approximately 0.035$\Omega$, is not a concern. The LTC6800 also draws very little current. Under no load the LTC6800 draws a maximum of 1.3mA.

\section{System Design} \label{sect:sysarch}
\subsection{Hardware Design} \label{sect:hardwaredesign}

\subsubsection{Power Sources}

The system is powered from eight solar cells that have been manufactured by RFCx. These solar panels have been reported to have an open circuit voltage of 1.6V and produce an average of 0.75W each under laboratory conditions. The other power sources on board are two dual-cell 4400mA/Hr lithium-ion (Li-ion) battery packs. As discussed in the MPPT configuration justification, the solar panels will be configured in a way that a pair on an individual petal may be wired in either series or parallel. The pairs will be wired how the end user would like them and the remaining wires will be connected to a terminal block with screw/leaf spring wire termination on the PCB board, which will be powering the MPPT controllers. This is illustrated in the figure \ref{fig:mpptsol}.

\begin{figure}[H]
	\centering
	\includegraphics[width=0.4\textwidth]{MPPTblocks}
	\caption{MPPT and Solar Panel Interface}
	\label{fig:mpptsol}
\end{figure}

With this configuration, a configurable output voltage of 5.2V, the maximum of the SPV1040, will be obtained at an average of about 1.15A, yeilding an input power of about 6W.

\subsubsection{Solar Charging}

A Max Point Power Tracker (MPPT) increases efficiency by adjusting the current and voltage of the output to achieve the maximum power. The SPV1040 will regulate the solar cell voltage up to 5.2V. From the MPPT the battery management circuitry, the 3.3V line, and the 5V line is powered. The input capacitor's purpose is to reduce voltage ripple. It was calculated that this capacitor must be greater than $14.3\mu F$. The 

\subsubsection{Battery Management}

The two dual-cell Lithium-Ion batteries are each managed by a bq2057CTS. Figure \ref{fig:batman} shows the battery management circuitry for one of the 2-cell battery packs. This IC provides voltage and current regulation, battery conditioning, temperature monitoring, charge termination, charge status indication, as well as charge-rate compensation. The charging is started in the constant voltage phase and stops when the current falls bellow the current termination threshold. The bq2057 inhibits charging until the battery temperature is in the user defined range. This range is defined in this circuit with resistor \textit{R24}. Only the lower temperature bound is set here because the device is not intended for cold environments. The charge rate compensation is set by resistors \textit{R10} and \textit{R22}. The automatic charge compensation helps to charge the batteries faster and compensate for the battery pack's internal impedance. 

\begin{figure}[H]
	\centering
	\includegraphics[width=0.7\textwidth]{BatteryManage}
	\caption{Battery Management Circuitry}
	\label{fig:batman}
\end{figure}
The calculations for the component selection for the battery management circuitry is included in Appendix \ref{sect:bqcalcs}.

\subsubsection{Voltage Regulation}

A diode-ORed power path management circuit was used to switch the power source that feeds the 3.3V and 5V regulation circuitry. This circuit is shown in figure \ref{fig:dored}. 
%@TODO Jesse: Describe this design in greater detail
\begin{figure}[H]
	\centering
	\includegraphics[width=0.6\textwidth]{DiodeOR}
	\caption{Diode Ored Circuit}
	\label{fig:dored}
\end{figure}

This circuit provides power path switching in under 100 $\mu$s, and there is virtually no dip in the output voltage during the switch. A dip of approximately 500mV was observed when using a transistor alone to simply switch between the two sources, as shown in the simulation figure in Appendix \ref{fig:doredsimres1}. With the diode-ORed topology, the switch is clean, as seen in the simulation figure in Appendix \ref{fig:doredsimres2}.

\begin{figure}[H]
	\centering
	\includegraphics[width=0.6\textwidth]{DiodeORSIM}
	\caption{Simulation of Diode Ored Circuit}
	\label{fig:doredsim}
\end{figure}

%@TODO Jesse: Move these and all descriptions of the simulation to the appendix

The two circuits were simulated with LTSpice. The same diode and transistor were used in each simulation. A load of 550mA was used because this is more than the calculated worst case current draw from the circuit.

\begin{figure}[H]
	\centering
	\includegraphics[width=0.6\textwidth]{DiodeORres1}
	\caption{Simulation Result of Old Diode Ored Circuit}
	\label{fig:doredsimres1}
\end{figure}

%@TODO Jesse: Move this description  and the one following the figure to the appendix also, as the results are summarized above
It can be seen that as the panel voltage is rising, there is a considerable dip to around 3.0V. If this occured, the 3.3V linear drop out regulator would not be able to regulate properly and the 3.3V line would be deactivated. The diode-ored controller topology simulation result can be seen in figure \ref{fig:doredsimres2}.
\begin{figure}[H]
	\centering
	\includegraphics[width=0.6\textwidth]{DiodeORres2}
	\caption{Simulation Result of Current Diode Ored Circuit}
	\label{fig:doredsimres2}
\end{figure}

Here it can be seen that there is a very small drop in voltage when powered only from battery and a reasonable drop when powered from the solar panel. This is the desired behavior.
%@TODO This stuff above too...

%@Joe: Why do you think it needs to be in the appendix. It is referenced in the body of the explanation. The reader would have to flip like 50 pages just to see what I am talking about. If there was some raw data I could see it being moved but this is relevant. What do you think?

\bigskip
The LM61428 is a step-up voltage regulator that is configured to boost the input voltage to 5V at an output current of up to 1A. The output voltage of 5V is used to power the Android phone.

%@TODO Jesse: Reference the calculations and the efficiency of the regulator, and compare with our projected 10% decrease in power (although we don't know what it actually consumes, I think topher did give us a number once in an skype chat that we documented. I wouldn't look too hard for it though)

\bigskip
The calculations for the surrounding components can be seen in Appendix \ref{fig:calc???}. The layout of the 5V boost regulator can be seen in the following figure.
\begin{figure}[H]
	\centering
	\includegraphics[width=0.6\textwidth]{PS5V}
	\caption{5V Voltage Regulation}
	\label{fig:ps5}
\end{figure}

%@TODO Jesse: Move the 'it was chosen because...' stuff to the justification section. Only talk about design here. Talk about the surrounding circuitry and the interface with the top level, etc.
A Texas Instruments SM72238 Micropower fixed 3.3V LDO is used to regulate the 3.3V line. This was chosen over a switching regulator because the minimum voltage of 3.7 and the output voltage of 3.3V were too close together, causing the duty cycle calculations to come out to negative or not meet certain regulator’s requirements. The SM72238 has very low dropout, which is in range for the need of this application. The only external components required by the LDO are two low ESR 1uF capacitors on the input and output.

\subsubsection{Input and Output Current and Voltage Sensing}

The ADS1015 is a 12-bit ADC that can communicate over I2C with the microcontroller. This ADC will operate in single shot mode and then go back to sleep. The ADS1015 uses a $\delta\sigma$ ADC and can perform conversions at rates up to 3300 samples per second. The microcontroller will initiate a conversion over I2C and be able to send the diagnostic to the phone for further processing. 

The LTC6800 instrumentation amplifier is used to sense the voltage across a known sense resistor. The input current sense circuit is configured to have a gain of around 80.5. The sense resistor has been selected to be 0.01$\Omega$. With this configuration the ADC will be able to sense the current with a resolution of 1mA/bit. The calculations for this section can be seen in Appendix \ref{fig:calc???}. The configuration of the current sense amplifier can be seen in Figure \ref{fig:AV} below. The input and output voltage are sensed with simple resistor dividers that are fed to the ADC.
\begin{figure}[H]
	\centering
	\includegraphics[width=0.4\textwidth]{AtoV}
	\caption{Current Sense Amplifier}
	\label{fig:AV}
\end{figure}

\subsubsection{Microcontroller}

%@TODO Joe: Move the details of the other MCU part numbers to the justification section and delete the rest of this paragraph
Three other microcontrollers were considered. Two ARM M0+ low power micro controllers were considered. The Atmel ATSAM ARM M0+ was not chosen because it drew more current than the 328P and was decided to be over kill for this application. Some nice features were that it had a built in USB module and required no external tools to program it. The Freescale KL25Z was also decided to be overkill for this application and was not chosen because the programming interface of the end user would have been difficult as it required a JTAG programmer. The other microcontroller was a Texas Instruments 16-bit RISC MSP430. This microcontroller was the most expensive, drew the highest current in active and sleep modes, and requires an external tool to program. The parametric search on Atmle's website was used to search for a microcontroller that had built in USB capabilities. There were only a few microcontrollers listed that were offered in flat packages and had built in USB and I2C modules. However, none of the microcontrollers had the \textit{picopower} capability, which was seen to be important for this project. The ATmega328P was chosen for microcontroller between the sensors and the phone. The ATmega328P does require an external tool to program but it does have low power sleep modes, it is cheap, its is simple, and it is well documented not only by Atmel but by a very large community. It is felt that this would benefit the end user the most in the future. The only supporting circuitry for the ATmega328P is the 6-pin in-circuit serial programming (ICSP) port, a 32kHz external crystal, and external pull up resistors on the I2C communication lines. The 32kHz crystal is included for the real time clock. The real time clock is used so that the ATmega328P microcontroller can go into a sleep mode and wake up later to conserve power usage. The ATmega328P also requires an FTDI IC to communicate with the phone over USB.

\subsubsection{Temperature and Humidity}

A temperature sensor (LM75BD, \ref{fig:lm75dat}) and a humidity/temperature sensor(HIH6130, \ref{fig:hihdat}) will be included on the board. Both of these interfaces are supplied but not intended to be populated at the same time. The purpose for providing a choice is because the available I2C humidity sensors seem to be around the \$15 range. This is a little expensive to include on every device but the end user may want to include the humidity sensor on some of the devices and only sense temperature. The schematic connections of the two ICs is shown in Figure \ref{fig:tandh}. 

\begin{figure}[H]
	\centering
	\includegraphics[width=0.4\textwidth]{temphumid}
	\caption{Temperature and Humidity Sensors}
	\label{fig:tandh}
\end{figure}

The LM75BD can sense temperature with a resolution of $0.125^{\circ}C$ and up to $+125^{\circ}C$. This resolution and temperature operating range is well withing the environmental conditions that the device is intended to operate in. 
The HIH6130 is a I2C capable humidity and temperature sensor can operate in the temperature range of $-25^{\circ}C$ to $85^{\circ}C$ and humidity in the range $\pm5 \%RH$. These ranges and limits are also within the ranges foreseen in the intended rain forest environment. 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%@TODO This is as far as I got... %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%@TODO Joe: Put \bigskip before each \textbf for formatting...

\subsubsection{Connectors}

The USB connection consists of a standard USB Micro A connector, soldered directly onto the board and is secured to the board as a strain-relief mechanism. A standard 3.5mm audio cable is used to connect the microphone. The existing standard GSM antenna adapter is used to interface with the phone’s onboard GSM module.

\subsubsection{GSM Interference}

The use of X2Y TDMA filtering capacitors will be tested to reduce the noise produced by the stopping and starting of GSM packets, which is in the audible range at ~217Hz. A pass-through 3.5mm microphone interface will be included to test the X2Y capacitors. In addition, a large heatsink will be attached to a large ground plane on one side of the board, and the phone will be attached to the same ground plane, which should help with some shielding.

\subsubsection{PCB Size}

Two size options were proposed for the PCB, including having only enough space for the components and having a long open space on the PCB for attaching the phone. Having a long PBC with space for the phone was chosen to simplify the assembly process for the device. The length of the open space is long enough to accommodate large phones, and variable length mounting holes in the PCB allow for any size phone to be securely mounted to the PCB using snap-fit mounting screws. A micro-USB cable is used to interface the phone to the rest of the board. Using a cable instead of a connector allows the use of any size phone in the device. Having the PCB only large enough to fit the electrical components on it requires a separate mounting mechanism for the phone, which complicates the assembly of the device.

\subsubsection{Heat Dissipation}

Multiple alternatives were explored for dissipating heat built up in the enclosure, including drilling holes into the enclosure, putting fans in the enclosure to control airflow in and out of the enclosure, and using a heat sink. Using a heat sink was chosen as the best design alternative for heat dissipation. Drilling holes in the enclosure can allow water, insects and dust to enter the enclosure. A wire mesh over the holes could be used to keep insects out of the enclosure, but water and dust could still get into the enclosure and damage the electronics. Running fans in the device creates a sound in a similar frequency range to the chainsaw noise the device is trying to detect. This can cause false detection of a chainsaw by the RFCx server. A heat sink also requires a hole to be drilled into the enclosure for the heat sink to reach outside of the enclosure. This opening is sealed with caulk or by other methods to prevent water, insects and dust from entering the enclosure. The battery cover on the phone is removed and thermal paste is used between the phone battery and the PBC, and between the PCB and the heat sink. This allows heat to dissipate out of the enclosure and help keep the phone attached to the PCB and the PCB attached to the heat sink. Vias in the PCB help heat to transfer more readily through the board instead of trying to transfer the heat through the fiberglass the board is made of.

\subsection{Hardware Implementation} \label{sect:hardwareimp}
\subsubsection{Heat Sink}

A heat sink, as described in Section \ref{sect:hardwaredesign} is shown in Figure 1.4.  The current design calls for a rectangular opening to be cut into the front face of the enclosure so that the heat sink may pass through.  The shape of the heat sink will be optimized for reduced interior air temperature through heat transfer calculations.

\subsection{Software Design} \label{sect:softwaredes}
The software used in the design will consists of C and C++ code running on the ATMega328P microcontroller, as well as a companion app (RFCx Sentinel) written in Java, running on the Android phone.
\begin{figure}[H]
	\centering
	\includegraphics[width=0.4\textwidth]{SoftwareUMLV2}
	\caption{Software UML Diagram}
	\label{fig:swuml}
\end{figure}

The microcontroller software gathers data from a humidity/temperature sensor, and input/output current and voltage. This data is sent via the ATMega328P serial port to the Android phone via the FTDI chip on the PCB and the usb-serial-for-android libraries on the phone.
Listing \ref{lst:snip} describes the basic functionality of the microcontroller software.

\begin{lstlisting}[language=C,label=lst:snip,caption=MCU Flow Code Snippet]
void wakeFromSleep() {
    //Get sensor measurements
    GetDiagnostics(&Diagnostics);
    //Send sensor measurements to phone
    SendDiagnostics(Diagnostics);
    //Go to sleep
    enterSleep();
}
\end{lstlisting}

\subsection{Software Implementation} \label{sect:softwareimp}
An ATMega328P microcontroller is be used to take measurements from the sensors. The temperature (and possibly humidity) measurements are sent digitally via I2C to the microcontroller. On the same I2C bus is the ADS1015, which has four single-ended analog inputs for reading the input current, input voltage, output current, and output voltage. This data is be sent to the phone using the standard AVR UART serial library.

The data, once sent to the phone, is be monitored by the RFCx Sentinel app. This app is written in Java in Android Studio, and uses the open-source usb-serial-for-android library. The app opens a connection upon discovering a compatible device (FTDI is compatible), and allows the user to view a streamlined interface with relevant data, as well as a tab for the raw hex dump of incoming serial data. The data may or may not be transmitted along with audio data to the RFCx server for real-time monitoring.


\section{Verification} \label{sect:verification}
This section outlines the steps that are planned to verify that the hardware and software operate in the intended manner. 
\subsection{Hardware Verification} \label{sect:hardwareverification}
To verify the power consumption of the devices in \ref{HWa}. the voltage applied and current drawn by the both the enhanced device and the current device will be measured over the course of 1 hour during a realistic usage scenario. The average power will be verified to not exceed 90\% of the existing device’s usage.

To verify \ref{HWf}. a visual inspection by volunteers will qualify camouflage schemes. A successful inspection will be one in which more than 80\% of the volunteers are unable to find the device within a 2 minute inspection window.

To verify \ref{HWg}. a sample group of people with varying skill levels will be asked to provide feedback the on assembly process.

\subsection{Software Verification} \label{sect:softwareverification}
To verify \ref{SWa}., audio will be recorded and compressed using multiple algorithms including the current algorithm. An infographic hosted on RFCx’s website, shown in Figure 2 illustrates the flow of data that is collected from the phone and analyzed on the server.

To verify \ref{HW3}, simple packets will be sent from the microcontroller to the phone. These packets can be verified with debug tools or simple programs on the microcontroller and the phone. A debug serial port may be included as a peripheral to the microcontroller to aid in debugging. Any analog values read by the microcontroller will be verified with shop equipment.

\section{Validation} \label{sect:validation}
\ref{HW2}, \ref{HWb}, and \ref{HWd} can be validated by inspecting the components on the PCB to ensure all required components are present on the board. Requirements \ref{HWg} and \ref{HWh} can be validated by handing the assembly instructions out to a sample group of people with varying skill levels and receiving feedback on the set of instructions from them. People with the ability to read other languages can be used if the documents have been translated from English into other languages.

\ref{HW4} can be validated by inspecting the total cost printed on the BOM for the enhanced device.

\ref{HW1}, \ref{HWa}, and \ref{HW3} can be validated by current and voltage measurements taken in the lab using a DMM. The power calculations made based on those measurements can be compared to similar calculations based on measurements taken from the current device. SPICE simulation data and values displayed on the RFCx Sentinel app will be compared to the actual power consumption of the new device.

\ref{SW1}, \ref{SW2}, \ref{SW3}, and \ref{HW3} can be validated by comparing the values reported in the RFCx Sentinel app to the calculated power consumption of the enhanced device.

\ref{HWc} can be validated by changing the scale factor in the microcontroller program, reprogramming the microcontroller from the PCB header and comparing the values displayed on the RFCx Sentinel app to the previous displayed values. The new values displayed on the RFCx Sentinel app should reflect the change to the scale factor in the microcontroller program.

\ref{HWc}, \ref{SW3}, and \ref{SWa} can be validated during a field test. The enhance device can be mounted at eye level in a tree and turned on to allow the device to start sending audio data to the RFCx server. Requirement \ref{HWf} can be validated by having a volunteer outside of the project search for the device in a wooded area without knowing what it looks like to see if it sticks out. A chainsaw can be turned on 0.25 miles from the device to trigger an alert and validate that the enhanced device can communicate with the RFCx server. The size of the audio recording sent to the RFCx server after employing the audio compression algorithm can be compared to the size of audio data sent to the RFCx server by the current device to determine the audio compression ratio of this algorithm. Both audio recordings can be played back to determine the level of audio interference created by GSM transmission.

\section{Project Budget and Schedule} \label{sect:budgetandschedule}
\subsection{Budget} \label{sect:budget}
This project will require minor funding for manufacturing and populating the PCB, and the materials to construct a new enclosure, as well as general testing and component costs. As RFCx is a non-profit organization working solely on grant money, this budget is not expected to be covered by them.
\begin{itemize}
\item \$400 = 4 x \$100 for PCB manufacturing
\item \$320 = 4 x \$80 for PCB components
\item \$200 = 1 x \$200 for general needs
\item Estimated Total: \$920
\end{itemize}

\section{Schedule} \label{sect:schedule}
The schedule in Figure \ref{fig:gantt} is the proposed schedule for all phases of the project. This will be used as a general timeline for guidance throughout the project.

\begin{figure}[H]
  \centering
  \includegraphics[scale=0.65, trim=0cm 12cm 0cm 0cm, clip=true]{Schedule.pdf}
  \caption{Gantt Chart for Schedule}
  \label{fig:gantt}
\end{figure}


\newpage
\vspace*{\fill}
\section*{\centering{Appendices}}
%@TODO Joe: Looks strange with just the work 'Appendices' on a blank page...
%@JOE: This was done so that in the contents there is a clear starting for where the Appendices start. Otherwise it looks weird because the sections are listed as "A Electrical Schematics". I thought it was clearer if it went "Appendicies\n A Electrical Schematics" 
\addcontentsline{toc}{section}{Appendicies}
\vspace*{\fill}
\newpage
\appendix
\section{Electrical Schematics} \label{sect:appendixA}
% \makeatletter
% \@addtoreset{figure}{section}
% \makeatother
% \renewcommand\thefigure{\current.\arabic{figure}}

%@TODO Jesse/Joe: Add caption text for all schematics!
\begin{figure}[H]
	\centering
	\includegraphics[page=1,width=0.9\textwidth]{RFCxSchematics.pdf}
	\caption{}
	\label{fig:schemp1}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[page=2,width=0.9\textwidth]{RFCxSchematics.pdf}
	\caption{}
	\label{fig:schemp2}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[page=3,width=0.9\textwidth]{RFCxSchematics.pdf}
	\caption{}
	\label{fig:schemp3}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[page=4,width=0.9\textwidth]{RFCxSchematics.pdf}
	\caption{}
	\label{fig:schemp4}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[page=5,width=0.9\textwidth]{RFCxSchematics.pdf}
	\caption{}
	\label{fig:schemp5}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[page=6,width=0.9\textwidth]{RFCxSchematics.pdf}
	\caption{}
	\label{fig:schemp6}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[page=7,width=0.9\textwidth]{RFCxSchematics.pdf}
	\caption{}
	\label{fig:schemp7}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[page=8,width=0.9\textwidth]{RFCxSchematics.pdf}
	\caption{}
	\label{fig:schemp8}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[page=9,width=0.9\textwidth]{RFCxSchematics.pdf}
	\caption{}
	\label{fig:schemp9}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[page=10,width=0.9\textwidth]{RFCxSchematics.pdf}
	\caption{}
	\label{fig:schemp10}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[page=11,width=0.9\textwidth]{RFCxSchematics.pdf}
	\caption{}
	\label{fig:schemp11}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[page=1,width=0.9\textwidth]{RFCxSchematics.pdf}
	\caption{}
	\label{fig:schemp1}
\end{figure}

\newpage
\section{Bill Of Materials} \label{sect:appendixB}
\begin{figure}[H]
	\centering
	\includegraphics[page=1,width=0.9\textwidth]{RFCx_BOM.pdf}
	\caption{}
	\label{fig:bom1}
\end{figure}
\begin{figure}[H]
	\centering
	\includegraphics[page=2,width=0.9\textwidth]{RFCx_BOM.pdf}
	\caption{}
	\label{fig:bom2}
\end{figure}


\newpage
\section{Mechanical Drawings} \label{sect:appendixC}

\newpage
\section{Calculations} \label{sect:appendixD}
\subsection{bq2057CTS Battery Management Calculations} \label{sect:bqcalcs}
\textbf{Current Regulation}
\begin{align}
  \label{eq:currentreg}
  R_{SNS} &= \frac{V_{SNS}}{IO_{REG}} \\
  &= \frac{105mV}{0.2 \cdot 4400mAHr} \\
  &= 119m\Omega
\end{align}
\textbf{Voltage Regulation}
\begin{align}
  \label{eq:voltreg}
  \frac{R_{B1}}{R_{B2}} &= \left(N \cdot \frac{V_{CELL}}{V_{OREG}}\right) - 1
\end{align}

\textbf{Temperature Monitoring} \newline
Using PTC thermistor

\textbf{External PNP Transistor} \newline
Max Power disipation when battery is lowest (3V)
\begin{align*}
  V_{in} &= 5.2 \\
  I_{REG} &= 880mA \\
  V_{CS} &= 0.176 \\
  V_D &= 0.3
\end{align*}
\begin{align}
  \label{eq:diodepwr}
  P_D &= \left(\left(V_{in} - V_D - V_{CS}\right) - V_{BAT}\right) * I_{REG} \\
  &= \left(5.2 - 0.3 - 0.176 - 3\right) \cdot 0.88 \\
  &= 1.517 W
\end{align}
\textbf{Calculate $\beta_{min}$}
\begin{align}
  \label{eq:betamin}
  \beta_{min} &= \frac{I_{Cmax}}{I_{B}} \\
  &= \frac{0.88}{0.035} \\
  &= 25.14
\end{align}
\textbf{Input Capacitor} \newline
$0.1\mu F$ Ceramic recommended on Vcc and Vss pins

\textbf{Automatic Charge Rate Compensation}
\begin{align}
  \label{eq:comp}
  V(z) &= 0.154 \\
  V(comp) &= \frac{0.154}{2.2} \\
  &= 0.07
\end{align}
\begin{align}
  \label{eq:comp2}
  V(pack) &= 4.2 + (2.2 \cdot 0.07)\\
  &= 4.354
\end{align}
\begin{align}
  \label{eq:comp3}
  \frac{V_{comp}}{V_{sns}} &= \frac{R_{comp2}}{R_{comp1}+R_{comp2}}
\end{align}
The data sheet recommended that $R_{comp2}$ be $10k\Omega$ and that $V_{sns}$ be $105mV$
\begin{align}
  \label{eq:rcomps}
  R_{comp1}&=\frac{R_{comp2} \cdot \left(V_{sns}-V_{comp}\right)}{V_{comp}} \\
  R_{comp1}&=\frac{10k \cdot (0.105 - 0.07)}{0.07} \\
  R_{comp1}&=5k\Omega
\end{align}

\subsection{Current and Voltage Sensing}
Using the LTC6800
\textbf{Output Voltage}
\begin{align}
  \label{eq:vout}
  V_{out} &= \left(1+\frac{R_2}{R_1}\right)\cdot V_{in}
\end{align}
\textbf{ADC Resolution 12-bit}
\begin{align}
  \label{eq:adcres}
  \frac{3.3V}{2^{12}} &= 805\mu V
\end{align}
If 1A is drawn under worst case scenario and a sense resistor of $10m\Omega$ is chosen and the intended resolution is 1mA/bit: \newline
%@TODO Jesse: finish this calculation
\begin{align}
  \label{eq:asense}
  R_{sense} &= 0.01 \Omega \\
  V_{sense} &= 0.01 V \\
  V_{ADCsupply} &= 3.3V \\
  Gain &= \frac{V_{ADCsupply}}{V_{sense}} \\
  &= \frac{3.3}{0.01} \\
  &= 330 \\
  3.3V/A \\
  \frac{805\mu V/Bit}{3.3} &= \\
  &=
\end{align}

\subsection{SPV1040 Calculations}
\textbf{Component Values}
\begin{align}
  \label{eq:vals}
  F_{SW}&=70k-130k,typ:100k \\
  V_{IN_RP_MAX}&=1V \\
  I_{SC} &= 1A \\
  T_{MPP} &= ~1ms
\end{align}
\textbf{Input Capacitor}
\begin{align}
  \label{eq:incap}
  C_{IN}&\geq \frac{I_{SC}}{F_{SW}\cdot V_{IN_RP_MAX}} \\
  &\geq \frac{1}{70k\cdot 1} \\
  &\geq 14.3\mu F
\end{align}
\textbf{Input Voltage Sensing Capacitor}



\newpage
\section{Data Sheet Snippets} \label{sect:appendixE}
This appendix contains the 1st sheet of the data sheets for the parts used in this project.
\begin{figure}[H]
	\centering
	\includegraphics[page=1,width=0.9\textwidth]{combined.pdf}
	\caption{1st Page of ADS1013 Datasheet}
	\label{fig:adsdat}
\end{figure}
\newpage
\begin{figure}[H]
	\centering
	\includegraphics[page=2,width=0.9\textwidth]{combined.pdf}
	\caption{1st Page of ATmega328P Datasheet}
	\label{fig:atmeldat}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[page=3,width=0.9\textwidth]{combined.pdf}
	\caption{1st Page of bq2057 Datasheet}
	\label{fig:bq2057dat}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[page=4,width=0.9\textwidth]{combined.pdf}
	\caption{1st Page of FZT788B Datasheet}
	\label{fig:ftzdat}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[page=5,width=0.9\textwidth]{combined.pdf}
	\caption{1st Page of HIH6130 Datasheet}
	\label{fig:hihdat}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[page=6,width=0.9\textwidth]{combined.pdf}
	\caption{1st Page of Li-Ion Battery Pack Datasheet}
	\label{fig:batdat}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[page=7,width=0.9\textwidth]{combined.pdf}
	\caption{1st Page of LM75B Datasheet}
	\label{fig:lm75dat}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[page=8,width=0.9\textwidth]{combined.pdf}
	\caption{1st Page of LMR61428 Datasheet}
	\label{fig:lmrdat}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[page=9,width=0.9\textwidth]{combined.pdf}
	\caption{1st Page of LTC4412 Datasheet}
	\label{fig:ltc4412dat}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[page=10,width=0.9\textwidth]{combined.pdf}
	\caption{1st Page of LTC6800 Datasheet}
	\label{fig:ltc6800dat}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[page=11,width=0.9\textwidth]{combined.pdf}
	\caption{1st Page of SM72238 Datasheet}
	\label{fig:sm72dat}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[page=12,width=0.9\textwidth]{combined.pdf}
	\caption{1st Page of SPV1040 Datasheet}
	\label{fig:spvdat}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[page=13,width=0.9\textwidth]{combined.pdf}
	\caption{1st Page of FTDI Datasheet}
	\label{fig:ftdidat}
\end{figure}
\newpage
\section{Source Code} \label{sect:appendixF}
%@TODO Joe: Add RFCx Sentinel Source Code and MCU Pseudo-code (maybe...)
\end{document}

% ======== For Reference =============
% H parameter for the figure environment
% keeps it from floating
\begin{figure}[H]
	\centering
	\includegraphics[width=0.8\textwidth]{FIG2_1b}
	\caption{Convolution of Identical Unit Step Sequences}
	\label{fig:21b}
\end{figure}
% To turn off caption numbering place this:
%\captionsetup[figure]{labelformat=empty}
% Before the figure, To turn back on:
%captionsetup[figure]{labelformat=default}
\begin{equation}
	\begin{array}{rcl}

	y[n] &=& 0.5x[n]+x[n-1]+2x[n-2]\\
	y[n] &=& 0.8y[n-1]+2x[n]\\
	y[n]-0.8y[n-1] &=& 2x[n-1]
	\end{array}
\end{equation}

\begin{subequations}
	\begin{align}
		h[n] &= 2\delta[n+1]-2\delta[n-1]\\
		x[n] &= \delta[n] + \delta[n-2]
	\end{align}
\end{subequations}

% Resize used to make table width of text, may be omitted
\begin{table}[h]
\resizebox{\textwidth}{!}{
\centering
\begin{tabular}{|c|c|c|c|}
\hline
Case & $Z_c$          & $l$           & $c$       \\ \hline
1    & $110.9 \Omega$ & 0.593 $\mu H$ & 0.048 nF  \\ \hline
2    & $171.3 \Omega$ & 0.803 $\mu H$  & 27.408 pF \\ \hline
3    & $327.3 \Omega$ & 1.102 $\mu H$  & 10.294 pF \\ \hline
\end{tabular}}
\caption{Calculated Parameters}
\label{tbl:calcd}
\end{table}

% Code Snippet:
\begin{lstlisting}[language=C,label=lala,caption=this thing]
  code snippet
\end{lstlisting}

% bulleted list
\begin{itemize}
\item this is an item
\end{itemize}

\renewcommand*\contentsname{ }
\tableofcontents
\listoffigures
